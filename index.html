<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAZ AI | OMEGA Studio</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@300;500;700;900&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #6366f1; /* Indigo */
            --accent: #d946ef; /* Fuchsia */
            --dark-bg: #030712;
            --card-bg: #111827;
            --border: rgba(255, 255, 255, 0.08);
            --text-main: #f9fafb;
            --text-sub: #9ca3af;
            --gradient: linear-gradient(135deg, var(--primary), var(--accent));
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-main);
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* --- Background Grid --- */
        .bg-grid {
            position: absolute; width: 100%; height: 100%; z-index: -1;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            mask-image: radial-gradient(circle at center, black, transparent 80%);
        }

        /* --- Sidebar (History) --- */
        .drawer {
            width: 320px;
            background: var(--card-bg);
            border-right: 1px solid var(--border);
            transform: translateX(-100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: fixed; top: 0; bottom: 0; left: 0; z-index: 50;
            display: flex; flex-direction: column;
            padding: 20px;
        }
        .drawer.open { transform: translateX(0); }
        .drawer-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .drawer-close { cursor: pointer; color: var(--text-sub); transition: 0.2s; }
        .drawer-close:hover { color: white; }
        
        .history-list { overflow-y: auto; flex: 1; display: grid; gap: 15px; }
        .history-card {
            background: rgba(0,0,0,0.3); border-radius: 12px; overflow: hidden;
            border: 1px solid var(--border); cursor: pointer; transition: 0.2s;
        }
        .history-card:hover { border-color: var(--primary); }
        .history-card img { width: 100%; height: 150px; object-fit: cover; }
        .history-meta { padding: 10px; font-size: 0.8rem; color: var(--text-sub); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* --- Main Content --- */
        .main {
            flex: 1;
            display: grid;
            grid-template-columns: 400px 1fr;
            height: 100%;
            position: relative;
            transition: margin-left 0.3s;
        }
        .drawer.open + .main { margin-left: 320px; } /* Push content on desktop */

        /* Left Panel: Controls */
        .controls-panel {
            background: rgba(17, 24, 39, 0.8);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border);
            padding: 30px;
            display: flex; flex-direction: column; gap: 25px;
            overflow-y: auto;
        }

        .logo { font-family: 'Exo 2', sans-serif; font-size: 2rem; font-weight: 800; letter-spacing: 2px; }
        .logo span { background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .label { font-size: 0.75rem; color: var(--text-sub); text-transform: uppercase; font-weight: 600; letter-spacing: 1px; margin-bottom: 10px; display: block; }

        textarea {
            width: 100%; height: 100px;
            background: #030712; border: 1px solid var(--border);
            color: white; padding: 15px; border-radius: 12px;
            resize: none; font-family: inherit; transition: 0.3s;
        }
        textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2); }

        /* Style Cards */
        .style-scroller { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
        .style-card {
            min-width: 100px; height: 120px;
            background: #030712; border: 1px solid var(--border);
            border-radius: 12px; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px;
            transition: 0.2s; position: relative; overflow: hidden;
        }
        .style-card.active { border-color: var(--accent); background: rgba(217, 70, 239, 0.1); }
        .style-card i { font-size: 1.5rem; color: var(--text-sub); }
        .style-card span { font-size: 0.8rem; font-weight: 600; }
        
        /* Modifiers */
        .chips { display: flex; flex-wrap: wrap; gap: 8px; }
        .chip {
            padding: 6px 12px; background: rgba(255,255,255,0.05);
            border-radius: 20px; font-size: 0.8rem; cursor: pointer; border: 1px solid transparent; transition: 0.2s;
        }
        .chip:hover { background: rgba(255,255,255,0.1); }
        .chip.active { background: var(--primary); color: white; }

        .generate-btn {
            margin-top: auto;
            background: var(--gradient);
            color: white; border: none; padding: 16px;
            border-radius: 12px; font-weight: 700; font-size: 1rem;
            cursor: pointer; display: flex; justify-content: center; align-items: center; gap: 10px;
            transition: transform 0.2s;
        }
        .generate-btn:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4); }
        .generate-btn:disabled { opacity: 0.7; cursor: not-allowed; }

        /* Right Panel: Preview */
        .preview-panel {
            position: relative;
            display: flex; align-items: center; justify-content: center;
            padding: 40px;
        }

        .art-board {
            max-width: 100%; max-height: 100%;
            border-radius: 16px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            display: none; object-fit: contain;
            border: 1px solid var(--border);
        }

        .placeholder { text-align: center; color: var(--text-sub); animation: float 6s infinite ease-in-out; }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

        .top-nav {
            position: absolute; top: 20px; left: 20px;
            display: flex; gap: 15px;
        }
        .nav-btn {
            background: rgba(0,0,0,0.5); border: 1px solid var(--border);
            color: white; width: 40px; height: 40px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center; cursor: pointer;
            transition: 0.2s;
        }
        .nav-btn:hover { background: white; color: black; }

        .loader-bar {
            position: absolute; top: 0; left: 0; width: 100%; height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            z-index: 10; display: none;
            animation: loadProgress 2s infinite ease-in-out;
            width: 0%;
        }
        @keyframes loadProgress { 0% { width: 0%; left: 0; } 50% { width: 70%; } 100% { width: 100%; left: 100%; } }

        /* Mobile */
        @media (max-width: 900px) {
            .main { grid-template-columns: 1fr; grid-template-rows: auto 1fr; }
            .controls-panel { height: auto; max-height: 40vh; border-right: none; border-bottom: 1px solid var(--border); }
            .preview-panel { height: 60vh; padding: 20px; }
            .drawer.open + .main { margin-left: 0; transform: translateX(320px); }
        }
    </style>
</head>
<body>

    <div class="bg-grid"></div>

    <!-- History Drawer -->
    <div class="drawer" id="drawer">
        <div class="drawer-header">
            <h3><i class="fa-solid fa-clock-rotate-left"></i> History</h3>
            <div class="drawer-close" onclick="toggleDrawer()"><i class="fa-solid fa-xmark fa-lg"></i></div>
        </div>
        <div class="history-list" id="historyList">
            <!-- JS items -->
        </div>
    </div>

    <div class="main">
        
        <!-- Controls -->
        <div class="controls-panel">
            <div class="logo">FAZ <span>OMEGA</span></div>
            
            <div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                    <span class="label">Prompt</span>
                    <span style="font-size: 0.7rem; color: var(--accent); cursor: pointer;" onclick="magicEnhance()"><i class="fa-solid fa-wand-magic-sparkles"></i> Enhance</span>
                </div>
                <textarea id="promptInput" placeholder="A futuristic city in the clouds..." spellcheck="false"></textarea>
            </div>

            <div>
                <span class="label">Visual Style</span>
                <div class="style-scroller">
                    <div class="style-card" onclick="selectStyle(this, 'Cyberpunk, neon lights')">
                        <i class="fa-solid fa-city"></i><span>Cyberpunk</span>
                    </div>
                    <div class="style-card" onclick="selectStyle(this, 'Hyper-realistic, 8k, Unreal Engine 5')">
                        <i class="fa-solid fa-camera"></i><span>Realism</span>
                    </div>
                    <div class="style-card" onclick="selectStyle(this, 'Studio Ghibli, Anime style')">
                        <i class="fa-solid fa-paintbrush"></i><span>Anime</span>
                    </div>
                    <div class="style-card" onclick="selectStyle(this, 'Low poly, 3D render, blender')">
                        <i class="fa-solid fa-cube"></i><span>3D</span>
                    </div>
                </div>
            </div>

            <div>
                <span class="label">Lighting & Comp</span>
                <div class="chips">
                    <div class="chip" onclick="toggleChip(this, 'Cinematic Lighting')">Cinematic</div>
                    <div class="chip" onclick="toggleChip(this, 'Volumetric Fog')">Foggy</div>
                    <div class="chip" onclick="toggleChip(this, 'Golden Hour')">Golden Hour</div>
                    <div class="chip" onclick="toggleChip(this, 'Wide Angle')">Wide Angle</div>
                    <div class="chip" onclick="toggleChip(this, 'Macro Lens')">Macro</div>
                </div>
            </div>

            <button class="generate-btn" id="genBtn" onclick="generate()">
                <span>GENERATE ART</span> <i class="fa-solid fa-arrow-right-long"></i>
            </button>
        </div>

        <!-- Preview -->
        <div class="preview-panel">
            <div class="loader-bar" id="loader"></div>
            
            <div class="top-nav">
                <div class="nav-btn" onclick="toggleDrawer()" title="History"><i class="fa-solid fa-bars"></i></div>
                <div class="nav-btn" onclick="downloadImage()" title="Download"><i class="fa-solid fa-download"></i></div>
            </div>

            <div class="placeholder" id="placeholder">
                <i class="fa-brands fa-space-awesome fa-4x" style="margin-bottom: 20px; opacity: 0.5;"></i>
                <h2>OMEGA ENGINE READY</h2>
                <p>Configure parameters and initiate generation.</p>
            </div>

            <img id="resultImage" class="art-board" alt="Generated Art">
        </div>

    </div>

    <script>
        const API_URL = "https://api.xyro.site/ai/magic-studio?prompt=";
        const promptInput = document.getElementById('promptInput');
        const resultImage = document.getElementById('resultImage');
        const placeholder = document.getElementById('placeholder');
        const loader = document.getElementById('loader');
        const genBtn = document.getElementById('genBtn');
        const historyList = document.getElementById('historyList');
        const drawer = document.getElementById('drawer');

        let selectedStyle = "";
        let activeChips = [];

        // --- 1. UI Logic ---
        function toggleDrawer() {
            drawer.classList.toggle('open');
        }

        function selectStyle(el, styleText) {
            document.querySelectorAll('.style-card').forEach(c => c.classList.remove('active'));
            if (selectedStyle === styleText) {
                selectedStyle = ""; // toggle off
            } else {
                el.classList.add('active');
                selectedStyle = styleText;
            }
        }

        function toggleChip(el, text) {
            el.classList.toggle('active');
            if (activeChips.includes(text)) {
                activeChips = activeChips.filter(t => t !== text);
            } else {
                activeChips.push(text);
            }
        }

        function magicEnhance() {
            const current = promptInput.value.trim();
            if(!current) return;
            const enhancements = "highly detailed, 8k resolution, masterpiece, sharp focus, trending on artstation";
            if(!current.includes("masterpiece")) {
                promptInput.value = `${current}, ${enhancements}`;
            }
        }

        // --- 2. Generation Logic ---
        async function generate() {
            const basePrompt = promptInput.value.trim();
            if (!basePrompt) return alert("Please enter a prompt.");

            // Build full prompt
            let finalPrompt = basePrompt;
            if (selectedStyle) finalPrompt += `, ${selectedStyle}`;
            if (activeChips.length > 0) finalPrompt += `, ${activeChips.join(", ")}`;

            // UI State
            placeholder.style.display = 'none';
            resultImage.style.display = 'none';
            loader.style.display = 'block';
            loader.style.width = '100%'; // Trigger animation css
            genBtn.disabled = true;
            genBtn.innerHTML = "RENDERING...";

            try {
                const response = await fetch(API_URL + encodeURIComponent(finalPrompt));
                
                if (!response.ok) throw new Error("Server Error");

                const contentType = response.headers.get("content-type");
                let imgUrl = "";

                if (contentType && contentType.includes("application/json")) {
                    const data = await response.json();
                    imgUrl = data.image || data.url; 
                } else {
                    const blob = await response.blob();
                    imgUrl = URL.createObjectURL(blob);
                }

                // Success
                resultImage.onload = () => {
                    loader.style.display = 'none';
                    resultImage.style.display = 'block';
                    genBtn.disabled = false;
                    genBtn.innerHTML = `<span>GENERATE ART</span> <i class="fa-solid fa-arrow-right-long"></i>`;
                    saveToHistory(imgUrl, basePrompt);
                };
                resultImage.src = imgUrl;

            } catch (err) {
                console.error(err);
                loader.style.display = 'none';
                placeholder.style.display = 'block';
                placeholder.innerHTML = `<h3 style="color:var(--accent)">Generation Failed</h3><p>Try again later.</p>`;
                genBtn.disabled = false;
                genBtn.innerHTML = "RETRY";
            }
        }

        // --- 3. History & Utils ---
        function saveToHistory(url, prompt) {
            // Create History Card UI
            const div = document.createElement('div');
            div.className = 'history-card';
            div.innerHTML = `
                <img src="${url}" loading="lazy">
                <div class="history-meta">${prompt}</div>
            `;
            div.onclick = () => {
                resultImage.src = url;
                resultImage.style.display = 'block';
                placeholder.style.display = 'none';
                promptInput.value = prompt;
                if(window.innerWidth < 900) toggleDrawer();
            };
            
            historyList.prepend(div);
            
            // Note: For true persistence across refresh, we'd need to convert blobs to Base64 
            // and save to localStorage, but for this session, this works perfectly.
        }

        function downloadImage() {
            if (!resultImage.src) return;
            const a = document.createElement('a');
            a.href = resultImage.src;
            a.download = `FAZ-OMEGA-${Date.now()}.png`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Shortcut
        promptInput.addEventListener('keydown', (e) => {
            if(e.ctrlKey && e.key === 'Enter') generate();
        });

    </script>
</body>
</html>
