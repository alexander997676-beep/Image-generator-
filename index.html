<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FAZ AI | NOVA Station</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #3b82f6; /* Blue */
            --accent: #f43f5e; /* Rose */
            --bg-dark: #0f172a;
            --panel-bg: #1e293b;
            --border: #334155;
            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; scrollbar-width: thin; scrollbar-color: var(--border) var(--bg-dark); }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Navbar --- */
        nav {
            height: 60px;
            background: rgba(15, 23, 42, 0.9);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 10;
        }
        
        .brand {
            font-family: 'Rajdhani', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: 1px;
        }
        .brand span { color: var(--primary); }
        .brand i { color: var(--accent); }

        .nav-actions { display: flex; gap: 15px; font-size: 0.9rem; color: var(--text-muted); }
        .shortcut-hint { background: #334155; padding: 2px 6px; border-radius: 4px; font-size: 0.75rem; }

        /* --- Main Layout --- */
        .workspace {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* --- Left Sidebar: Prompt Builder --- */
        .sidebar {
            width: 280px;
            background: var(--panel-bg);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 15px;
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
        }

        .category-btn {
            padding: 12px 15px;
            width: 100%;
            text-align: left;
            background: transparent;
            border: none;
            color: var(--text-main);
            border-bottom: 1px solid var(--border);
            cursor: pointer;
            display: flex; justify-content: space-between; align-items: center;
            transition: 0.2s;
        }
        .category-btn:hover { background: rgba(255,255,255,0.05); }
        .category-btn i { font-size: 0.8rem; transition: 0.3s; }
        .category-btn.active i { transform: rotate(180deg); }

        .tags-container {
            display: none; /* Hidden by default */
            padding: 10px;
            background: rgba(0,0,0,0.2);
            flex-wrap: wrap;
            gap: 8px;
        }
        .tags-container.show { display: flex; }

        .tag {
            font-size: 0.75rem;
            padding: 4px 10px;
            border-radius: 4px;
            background: #334155;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid transparent;
        }
        .tag:hover { background: var(--primary); color: white; }
        .tag.selected { border-color: var(--accent); color: var(--accent); }

        /* --- Center: Canvas --- */
        .main-stage {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 20px;
            position: relative;
            background-image: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%);
        }

        /* Toolbar */
        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: flex-end;
        }
        
        .tool-btn {
            background: var(--panel-bg);
            border: 1px solid var(--border);
            color: var(--text-main);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex; align-items: center; gap: 6px;
            transition: 0.2s;
        }
        .tool-btn:hover { border-color: var(--primary); color: var(--primary); }

        /* Image Area */
        .canvas-area {
            flex: 1;
            border: 2px dashed var(--border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
            transition: 0.3s;
        }
        .canvas-area.active { border-style: solid; border-color: transparent; background: black; }

        #resultImg {
            max-width: 100%; max-height: 100%;
            object-fit: contain;
            display: none;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            transition: filter 0.3s;
        }

        /* Filter Controls Overlay */
        .filter-dock {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(15, 23, 42, 0.9); border: 1px solid var(--border);
            padding: 10px; border-radius: 30px;
            display: none; gap: 10px;
        }
        .filter-btn {
            width: 30px; height: 30px; border-radius: 50%; border: 1px solid #555; cursor: pointer;
        }

        /* --- Bottom: Input Area --- */
        .input-dock {
            padding: 20px;
            background: var(--panel-bg);
            border-top: 1px solid var(--border);
            display: flex;
            gap: 15px;
        }

        .prompt-wrapper {
            flex: 1;
            position: relative;
        }

        textarea {
            width: 100%;
            height: 60px;
            background: #0f172a;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px 15px;
            color: white;
            font-family: inherit;
            resize: none;
            transition: 0.2s;
        }
        textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2); }

        .btn-gen {
            width: 120px;
            background: linear-gradient(135deg, var(--primary), #2563eb);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
        }
        .btn-gen:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4); }
        .btn-gen:disabled { opacity: 0.6; cursor: wait; }

        /* --- Right Sidebar: History --- */
        .history-bar {
            width: 80px;
            background: var(--panel-bg);
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 0;
            overflow-y: auto;
            gap: 10px;
        }
        
        .history-thumb {
            width: 60px; height: 60px;
            border-radius: 8px;
            border: 2px solid transparent;
            cursor: pointer;
            overflow: hidden;
            transition: 0.2s;
            background: #0f172a;
        }
        .history-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .history-thumb:hover { border-color: var(--primary); }
        .history-thumb.active { border-color: var(--accent); }

        /* Loader */
        .nova-loader {
            display: none;
            width: 60px; height: 60px;
            border: 3px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        @media (max-width: 900px) {
            .sidebar { display: none; } /* Hide prompt builder on mobile */
            .history-bar { width: 60px; }
            .input-dock { padding: 10px; }
        }
    </style>
</head>
<body>

    <nav>
        <div class="brand">
            <i class="fa-solid fa-atom"></i> FAZ <span>AI</span> NOVA
        </div>
        <div class="nav-actions">
            <span><i class="fa-solid fa-keyboard"></i> <span class="shortcut-hint">/</span> to focus</span>
            <span><span class="shortcut-hint">Ctrl+Enter</span> to run</span>
        </div>
    </nav>

    <div class="workspace">
        
        <!-- Left Sidebar: Builder -->
        <div class="sidebar">
            <div class="sidebar-header">Prompt Builder</div>
            
            <!-- Category 1 -->
            <button class="category-btn" onclick="toggleCategory('styleTags')">
                Art Styles <i class="fa-solid fa-chevron-down"></i>
            </button>
            <div class="tags-container" id="styleTags">
                <div class="tag" onclick="addTag('Cyberpunk')">Cyberpunk</div>
                <div class="tag" onclick="addTag('Anime')">Anime</div>
                <div class="tag" onclick="addTag('Oil Painting')">Oil Painting</div>
                <div class="tag" onclick="addTag('Hyperrealistic')">Realistic</div>
                <div class="tag" onclick="addTag('Vaporwave')">Vaporwave</div>
                <div class="tag" onclick="addTag('Noir')">Noir</div>
            </div>

            <!-- Category 2 -->
            <button class="category-btn" onclick="toggleCategory('lightTags')">
                Lighting <i class="fa-solid fa-chevron-down"></i>
            </button>
            <div class="tags-container" id="lightTags">
                <div class="tag" onclick="addTag('Cinematic Lighting')">Cinematic</div>
                <div class="tag" onclick="addTag('Golden Hour')">Golden Hour</div>
                <div class="tag" onclick="addTag('Neon Lights')">Neon</div>
                <div class="tag" onclick="addTag('Volumetric Fog')">Fog</div>
                <div class="tag" onclick="addTag('Studio Lighting')">Studio</div>
            </div>

            <!-- Category 3 -->
            <button class="category-btn" onclick="toggleCategory('cameraTags')">
                Camera <i class="fa-solid fa-chevron-down"></i>
            </button>
            <div class="tags-container" id="cameraTags">
                <div class="tag" onclick="addTag('Wide Angle')">Wide Angle</div>
                <div class="tag" onclick="addTag('Macro Lens')">Macro</div>
                <div class="tag" onclick="addTag('Bokeh')">Bokeh</div>
                <div class="tag" onclick="addTag('8k Resolution')">8k</div>
                <div class="tag" onclick="addTag('GoPro View')">Fisheye</div>
            </div>

            <!-- Category 4 -->
            <button class="category-btn" onclick="toggleCategory('renderTags')">
                Render Engine <i class="fa-solid fa-chevron-down"></i>
            </button>
            <div class="tags-container" id="renderTags">
                <div class="tag" onclick="addTag('Unreal Engine 5')">UE5</div>
                <div class="tag" onclick="addTag('Octane Render')">Octane</div>
                <div class="tag" onclick="addTag('Ray Tracing')">Ray Traced</div>
                <div class="tag" onclick="addTag('V-Ray')">V-Ray</div>
            </div>
        </div>

        <!-- Center: Canvas -->
        <div class="main-stage">
            <div class="toolbar">
                <button class="tool-btn" onclick="applyFilter('none')"><i class="fa-solid fa-ban"></i> No Filter</button>
                <button class="tool-btn" onclick="applyFilter('grayscale(100%)')"><i class="fa-solid fa-droplet-slash"></i> B&W</button>
                <button class="tool-btn" onclick="applyFilter('contrast(150%)')"><i class="fa-solid fa-circle-half-stroke"></i> Contrast</button>
                <button class="tool-btn" onclick="downloadImage()"><i class="fa-solid fa-download"></i> Save</button>
            </div>

            <div class="canvas-area" id="canvasArea">
                <div class="nova-loader" id="loader"></div>
                <div id="placeholder" style="text-align:center; color:#334155;">
                    <i class="fa-brands fa-connectdevelop fa-4x"></i>
                    <p style="margin-top:10px;">NOVA ENGINE STANDBY</p>
                </div>
                <img id="resultImg" alt="Result">
            </div>
        </div>

        <!-- Right: History -->
        <div class="history-bar" id="historyBar">
            <!-- Filled by JS -->
        </div>

    </div>

    <!-- Bottom Input -->
    <div class="input-dock">
        <div class="prompt-wrapper">
            <textarea id="promptInput" placeholder="Describe your creation... (e.g., A cat in space suit)" spellcheck="false"></textarea>
        </div>
        <button class="btn-gen" id="genBtn" onclick="generate()">
            GENERATE
        </button>
    </div>

    <script>
        const API_URL = "https://api.xyro.site/ai/magic-studio?prompt=";
        const promptInput = document.getElementById('promptInput');
        const resultImg = document.getElementById('resultImg');
        const loader = document.getElementById('loader');
        const placeholder = document.getElementById('placeholder');
        const canvasArea = document.getElementById('canvasArea');
        const genBtn = document.getElementById('genBtn');
        const historyBar = document.getElementById('historyBar');

        // State
        let sessionHistory = JSON.parse(localStorage.getItem('faz_nova_history')) || [];

        // Init
        renderHistory();

        // 1. Prompt Builder Logic
        function toggleCategory(id) {
            const el = document.getElementById(id);
            // Toggle show class
            el.classList.toggle('show');
            // Rotate icon logic handled in CSS/HTML structure
            const btn = el.previousElementSibling;
            btn.classList.toggle('active');
        }

        function addTag(tag) {
            const current = promptInput.value;
            // Append with comma if needed
            if(current.length > 0 && !current.endsWith(', ')) {
                promptInput.value = current + ", " + tag;
            } else {
                promptInput.value = current + tag;
            }
            promptInput.focus();
        }

        // 2. Generation Logic
        async function generate() {
            const prompt = promptInput.value.trim();
            if(!prompt) return alert("Prompt required");

            // UI Loading
            setLoading(true);

            try {
                // Auto-append quality tags if missing
                let finalPrompt = prompt;
                if(!prompt.toLowerCase().includes('detailed')) {
                    finalPrompt += ", highly detailed, 8k, sharp focus";
                }

                const response = await fetch(API_URL + encodeURIComponent(finalPrompt));
                if(!response.ok) throw new Error("API Error");

                const blob = await response.blob();
                const url = URL.createObjectURL(blob);

                resultImg.onload = () => {
                    setLoading(false);
                    addToHistory(url, prompt);
                };
                resultImg.src = url;

            } catch (err) {
                console.error(err);
                setLoading(false);
                alert("Generation Failed");
                // Restore placeholder if needed
                if(resultImg.style.display === 'none') placeholder.style.display = 'block';
            }
        }

        function setLoading(isLoading) {
            if(isLoading) {
                genBtn.disabled = true;
                genBtn.innerText = "BUSY...";
                placeholder.style.display = 'none';
                resultImg.style.display = 'none';
                loader.style.display = 'block';
                canvasArea.classList.remove('active');
            } else {
                genBtn.disabled = false;
                genBtn.innerText = "GENERATE";
                loader.style.display = 'none';
                resultImg.style.display = 'block';
                canvasArea.classList.add('active');
            }
        }

        // 3. History System
        function addToHistory(url, prompt) {
            // Convert to Base64 to save in LS (Truncated for demo performance, usually store URLs or Blob Refs)
            const reader = new FileReader();
            reader.readAsDataURL(await (await fetch(url)).blob()); // Simple blob to base64
            
            reader.onloadend = () => {
                const base64data = reader.result;
                const item = { id: Date.now(), img: base64data, prompt: prompt };
                sessionHistory.unshift(item);
                if(sessionHistory.length > 10) sessionHistory.pop(); // Limit 10
                
                localStorage.setItem('faz_nova_history', JSON.stringify(sessionHistory));
                renderHistory();
            }
        }

        async function addToHistory(url, prompt) {
            // For this live demo, we won't deep clone the blob to LS to avoid quota errors.
            // We will just update the UI sidebar for the current session.
            const div = document.createElement('div');
            div.className = 'history-thumb';
            div.innerHTML = `<img src="${url}">`;
            div.onclick = () => {
                resultImg.src = url;
                promptInput.value = prompt;
                setLoading(false);
            };
            historyBar.prepend(div);
        }

        function renderHistory() {
            // Re-bind not implemented for LS in this specific snippet to keep it light
            // But UI is ready for session pushing
        }

        // 4. Tools
        function applyFilter(filter) {
            resultImg.style.filter = filter;
        }

        function downloadImage() {
            if(!resultImg.src) return;
            const a = document.createElement('a');
            a.href = resultImg.src;
            a.download = `FAZ_NOVA_${Date.now()}.png`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // 5. Shortcuts
        document.addEventListener('keydown', (e) => {
            // Focus input on slash
            if(e.key === '/' && document.activeElement !== promptInput) {
                e.preventDefault();
                promptInput.focus();
            }
            // Generate on Ctrl+Enter
            if(e.key === 'Enter' && e.ctrlKey) {
                generate();
            }
        });

    </script>
</body>
</html>
